---
title: 实战SSH端口隧道转发
date: 2018-09-08 12:34:01
tags:
 - ssh
 - 端口转发
---
[参考文档](http://www.ruanyifeng.com/blog/2011/12/ssh_port_forwarding.html)
[利用ssh-copy-id实现SSH无密码登录](http://blog.51cto.com/qiangsh/1964412)
[使用SSH反向隧道进行内网穿透](https://www.jianshu.com/p/f5bc96f09c25)
### [调试利器 - 端口转发 - ssh隧道技术](https://www.jianshu.com/p/3f5d923a8d41)

如何建立远程SSH隧道
通过建立本地SSH隧道，我们成功地绕过防火墙开始下载FTP上的资源了。那么当我们在家里的时候想要察看下载进度怎么办呢？大多数公司的网络是通过路由器接入互联网的，公司内部的机器不会直接与互联网连接，也就是不能通过互联网直接访问。通过线路D-B-A访问公司里的机器a便是不可能的。也许你已经注意到了，虽然D-B-A这个方向的连接不通，但是A-B-D这个方向的连接是没有问题的。那么，我们能否利用一条已经连接好的A-B-D方向的连接来完成D-B-A方向的访问呢？答案是肯定的，这就是远程SSH隧道的用途。

与本地SSH一样，我们在建立远程SSH隧道之前要清楚下面几个参数：

需要访问内部机器的远程机器的IP地址（这里是123.123.123.123）
需要让远程机器能访问的内部机器的IP地址(这里因为是想把本机映射出去，因此IP是127.0.0.1)
需要让远程机器能访问的内部机器的端口号(端口:22)
在清楚了上面的参数后，我们使用下面的命令来建立一个远程SSH隧道
```shell
ssh -N -f -R 2222:127.0.0.1:22      123.123.123.123
```
现在，在IP是123.123.123.123的机器上我们用下面的命令就可以登陆公司的IP是192.168.0.100的机器了。
```shell
ssh -p 2222 localhost
```
-N，-f 这两个参数我们已经在本地SSH隧道中介绍过了。我们现在重点说说参数-R。该参数的三个部分的含义分别是:

远程机器使用的端口（2222）
需要映射的内部机器的IP地址(127.0.0.1)
需要映射的内部机器的端口(22)
例如：-R X:Y:Z 就是把我们内部的Y机器的Z端口映射到远程机器的X端口上
